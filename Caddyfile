{
    admin off
    order ml_waf before respond
    log {
        level debug
    }
}

:8082 {
    handle {
        ml_waf {
            # Thresholds
            anomaly_threshold 0.5                  # Increased to reduce false positives
            blocking_threshold 0.7                # Increased to reduce false positives

            # Normal ranges for request attributes
            normal_request_size_range 50 5000      # Adjusted to allow larger requests
            normal_header_count_range 3 25         # Adjusted to allow more headers
            normal_query_param_count_range 0 10    # Adjusted to allow more query parameters
            normal_path_segment_count_range 1 5    # Unchanged

            # Additional attributes
            normal_http_methods GET POST           # Allowed HTTP methods (e.g., GET, POST)
            normal_user_agents fab Mozilla         # Added Mozilla to allowed User-Agents
            normal_referrers https://example.com   # Allowed Referrer headers (e.g., trusted domains)

            # Weights (sum = 1)
            request_size_weight 0.25               # Unchanged
            header_count_weight 0.2                # Unchanged
            query_param_count_weight 0.15          # Unchanged
            http_method_weight 0.1                 # Unchanged
            user_agent_weight 0.1                  # Unchanged
            referrer_weight 0.05                   # Unchanged
            path_segment_count_weight 0.05         # Unchanged
            request_frequency_weight 0.1           # Adjusted to account for request bursts

            # Request history settings
            history_window 5m                      # Unchanged
            max_history_entries 10000              # Unchanged

            # Per-path configuration for /api
            per_path_config /etc/passwd {
                anomaly_threshold 0.05
                blocking_threshold 0.1
            }
            per_path_config /.env {
                anomaly_threshold 0.05
                blocking_threshold 0.1
            }
            per_path_config /api {
                anomaly_threshold 0.2
                blocking_threshold 0.4
            }   
            per_path_config /login {
                anomaly_threshold 0.2
                blocking_threshold 0.4
            }             
        }
        respond "Hello, world!" 200
    }
}
